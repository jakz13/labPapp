<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InicioSesion.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MiProyectoSwing</a> &gt; <a href="index.source.html" class="el_package">Presentacion.gui.guiSesion</a> &gt; <span class="el_source">InicioSesion.java</span></div><h1>InicioSesion.java</h1><pre class="source lang-java linenums">package Presentacion.gui.guiSesion;

import logica.Fabrica;
import logica.ISistema;
import logica.TipoDoc;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ComponentAdapter;
import java.awt.event.ComponentEvent;
import java.time.LocalDate;

public class InicioSesion {
    private JPanel PanelDeSesion;
    private JButton ALTAVUELOButton;
    private JButton ALTACIUDADButton;
    private JTextField NombreUsuario;  // Nickname (clave)
    private JTextField NombreCliente;
    private JTextField Apellido;
    private JButton crearButton;
    private JButton cancelarButton;
    private JTextField EmailUsuario;
    private JTextField Documento;
    private JRadioButton PasaporteRadioButton;
    private JRadioButton CiRadioButton;
    private JTextField NacionalidadCliente;
    private JComboBox DiaNacimiento;
    private JComboBox MesNacimiento;
    private JComboBox AnoNacimiento;
    private JPasswordField passwordField;
    private JPasswordField ConfirmacionPassword;

<span class="nc" id="L35">    public InicioSesion() {</span>
<span class="nc" id="L36">        ISistema sistema = Fabrica.getInstance().getISistema();</span>
<span class="nc" id="L37">        ButtonGroup grupoDocumento = new ButtonGroup();</span>
<span class="nc" id="L38">        grupoDocumento.add(PasaporteRadioButton);</span>
<span class="nc" id="L39">        grupoDocumento.add(CiRadioButton);</span>

<span class="nc" id="L41">        PanelDeSesion.addComponentListener(new ComponentAdapter() {</span>
            @Override
            public void componentShown(ComponentEvent e) {
<span class="nc" id="L44">                super.componentShown(e);</span>
<span class="nc" id="L45">            }</span>
        });

<span class="nc" id="L48">        crearButton.addActionListener(new ActionListener() {</span>
            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L51">                String nickname = NombreUsuario.getText().trim();  // Nickname (clave)</span>
<span class="nc" id="L52">                String nombreCliente = NombreCliente.getText().trim();</span>
<span class="nc" id="L53">                String apellido = Apellido.getText().trim();</span>
<span class="nc" id="L54">                String email = EmailUsuario.getText().trim();</span>
<span class="nc" id="L55">                String documento = Documento.getText().trim();</span>
<span class="nc" id="L56">                String nacionalidad = NacionalidadCliente.getText().trim();</span>
<span class="nc" id="L57">                String password = new String(passwordField.getPassword()).trim();</span>
<span class="nc" id="L58">                String confirmacion = new String(ConfirmacionPassword.getPassword()).trim();</span>

                TipoDoc tipoDoc;

<span class="nc" id="L62">                String diaStr = (String) DiaNacimiento.getSelectedItem();</span>
<span class="nc" id="L63">                String mesStr = (String) MesNacimiento.getSelectedItem();</span>
<span class="nc" id="L64">                String anioStr = (String) AnoNacimiento.getSelectedItem();</span>

                // =================== VALIDACIONES ===================

                // Validaciones de campos obligatorios
<span class="nc bnc" id="L69" title="All 6 branches missed.">                if (nickname.isEmpty() || nombreCliente.isEmpty() || apellido.isEmpty() ||</span>
<span class="nc bnc" id="L70" title="All 6 branches missed.">                        email.isEmpty() || documento.isEmpty() || nacionalidad.isEmpty() ||</span>
<span class="nc bnc" id="L71" title="All 4 branches missed.">                        password.isEmpty() || confirmacion.isEmpty()) {</span>
<span class="nc" id="L72">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;Debe completar todos los campos.&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L75">                    return;</span>
                }

                // Validaci√≥n de contrase√±as
<span class="nc bnc" id="L79" title="All 2 branches missed.">                if (!password.equals(confirmacion)) {</span>
<span class="nc" id="L80">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;Las contrase√±as no coinciden.&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L83">                    passwordField.setText(&quot;&quot;);</span>
<span class="nc" id="L84">                    ConfirmacionPassword.setText(&quot;&quot;);</span>
<span class="nc" id="L85">                    return;</span>
                }

                // Validaci√≥n de fortaleza de contrase√±a
<span class="nc bnc" id="L89" title="All 2 branches missed.">                if (password.length() &lt; 6) {</span>
<span class="nc" id="L90">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;La contrase√±a debe tener al menos 6 caracteres.&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L93">                    passwordField.setText(&quot;&quot;);</span>
<span class="nc" id="L94">                    ConfirmacionPassword.setText(&quot;&quot;);</span>
<span class="nc" id="L95">                    return;</span>
                }

                // Validaci√≥n de caracteres especiales en contrase√±a
<span class="nc bnc" id="L99" title="All 6 branches missed.">                if (!password.matches(&quot;.*[A-Z].*&quot;) || !password.matches(&quot;.*[a-z].*&quot;) || !password.matches(&quot;.*\\d.*&quot;)) {</span>
<span class="nc" id="L100">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;La contrase√±a debe contener al menos:\n- Una letra may√∫scula\n- Una letra min√∫scula\n- Un n√∫mero&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L103">                    passwordField.setText(&quot;&quot;);</span>
<span class="nc" id="L104">                    ConfirmacionPassword.setText(&quot;&quot;);</span>
<span class="nc" id="L105">                    return;</span>
                }

                // Validaci√≥n de tipo de documento
<span class="nc bnc" id="L109" title="All 4 branches missed.">                if (!CiRadioButton.isSelected() &amp;&amp; !PasaporteRadioButton.isSelected()) {</span>
<span class="nc" id="L110">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;Debe seleccionar un tipo de documento.&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L113">                    return;</span>
                }

                // Validaci√≥n de fecha
<span class="nc bnc" id="L117" title="All 6 branches missed.">                if (diaStr.equals(&quot;D√≠a&quot;) || mesStr.equals(&quot;Mes&quot;) || anioStr.equals(&quot;A√±o&quot;)) {</span>
<span class="nc" id="L118">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;Debe seleccionar una fecha v√°lida.&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L121">                    return;</span>
                }

                // Validaci√≥n de email
<span class="nc bnc" id="L125" title="All 2 branches missed.">                if (!email.matches(&quot;^[\\w.-]+@[\\w.-]+\\.[a-zA-Z]{2,}$&quot;)) {</span>
<span class="nc" id="L126">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;Correo electr√≥nico no v√°lido.&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L129">                    return;</span>
                }

                // Validaciones espec√≠ficas por tipo de documento
<span class="nc bnc" id="L133" title="All 2 branches missed.">                if (CiRadioButton.isSelected()) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                    if (!documento.matches(&quot;\\d{8}&quot;)) {</span>
<span class="nc" id="L135">                        JOptionPane.showMessageDialog(null,</span>
                                &quot;La CI debe tener exactamente 8 n√∫meros.&quot;,
                                &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L138">                        return;</span>
                    }
<span class="nc" id="L140">                    tipoDoc = TipoDoc.CEDULAIDENTIDAD;</span>
                } else {
<span class="nc bnc" id="L142" title="All 2 branches missed.">                    if (!documento.matches(&quot;[A-Z]{2}\\d{6}&quot;)) {</span>
<span class="nc" id="L143">                        JOptionPane.showMessageDialog(null,</span>
                                &quot;El pasaporte debe tener el formato: 2 letras + 6 n√∫meros\nEjemplo: AB123456&quot;,
                                &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L146">                        return;</span>
                    }
<span class="nc" id="L148">                    tipoDoc = TipoDoc.PASAPORTE;</span>
                }

                // Validaci√≥n de fecha de nacimiento
                try {
<span class="nc" id="L153">                    int dia = Integer.parseInt(diaStr);</span>
<span class="nc" id="L154">                    int mes = Integer.parseInt(mesStr);</span>
<span class="nc" id="L155">                    int anio = Integer.parseInt(anioStr);</span>

<span class="nc" id="L157">                    LocalDate fechaNacimiento = LocalDate.of(anio, mes, dia);</span>
<span class="nc" id="L158">                    LocalDate hoy = LocalDate.now();</span>

                    // Validar que la fecha no sea en el futuro
<span class="nc bnc" id="L161" title="All 2 branches missed.">                    if (fechaNacimiento.isAfter(hoy)) {</span>
<span class="nc" id="L162">                        JOptionPane.showMessageDialog(null,</span>
                                &quot;La fecha de nacimiento no puede ser futura.&quot;,
                                &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L165">                        return;</span>
                    }

                    // Validar edad m√≠nima (por ejemplo, 18 a√±os)
<span class="nc" id="L169">                    LocalDate fechaMinima = hoy.minusYears(18);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">                    if (fechaNacimiento.isAfter(fechaMinima)) {</span>
<span class="nc" id="L171">                        JOptionPane.showMessageDialog(null,</span>
                                &quot;Debe ser mayor de 18 a√±os para registrarse.&quot;,
                                &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L174">                        return;</span>
                    }

                    // =================== CREAR CLIENTE ===================
<span class="nc" id="L178">                    sistema.altaCliente(nickname, nombreCliente, apellido, email,</span>
                            fechaNacimiento, nacionalidad, tipoDoc, documento, password,null);

<span class="nc" id="L181">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;‚úÖ Cliente creado correctamente\n\n&quot; +
                                    &quot;Nickname: &quot; + nickname + &quot;\n&quot; +
                                    &quot;Nombre: &quot; + nombreCliente + &quot; &quot; + apellido + &quot;\n&quot; +
                                    &quot;Email: &quot; + email + &quot;\n&quot; +
                                    &quot;Fecha Nac: &quot; + fechaNacimiento + &quot;\n&quot; +
                                    &quot;üåç Nacionalidad: &quot; + nacionalidad + &quot;\n&quot; +
                                    &quot;Documento: &quot; + tipoDoc + &quot; &quot; + documento,
                            &quot;Cliente Creado - √âxito&quot;,
                            JOptionPane.INFORMATION_MESSAGE);

                    // Limpiar campos despu√©s del √©xito
<span class="nc" id="L193">                    limpiarCampos();</span>

<span class="nc" id="L195">                } catch (NumberFormatException ex) {</span>
<span class="nc" id="L196">                    JOptionPane.showMessageDialog(null,</span>
                            &quot;Error en el formato de la fecha.&quot;,
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L199">                } catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L200">                    JOptionPane.showMessageDialog(null,</span>
<span class="nc" id="L201">                            &quot;Error al crear el cliente:\n&quot; + ex.getMessage(),</span>
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L203">                } catch (Exception ex) {</span>
<span class="nc" id="L204">                    JOptionPane.showMessageDialog(null,</span>
<span class="nc" id="L205">                            &quot;Error inesperado: &quot; + ex.getMessage(),</span>
                            &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L207">                }</span>
<span class="nc" id="L208">            }</span>
        });

<span class="nc" id="L211">        cancelarButton.addActionListener(new ActionListener() {</span>
            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L214">                Window window = SwingUtilities.getWindowAncestor(PanelDeSesion);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (window != null) {</span>
<span class="nc" id="L216">                    window.dispose();</span>
                }
<span class="nc" id="L218">            }</span>
        });

        // Mejoras de usabilidad
<span class="nc" id="L222">        passwordField.addActionListener(new ActionListener() {</span>
            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L225">                ConfirmacionPassword.requestFocus();</span>
<span class="nc" id="L226">            }</span>
        });

<span class="nc" id="L229">        ConfirmacionPassword.addActionListener(new ActionListener() {</span>
            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L232">                crearButton.doClick();</span>
<span class="nc" id="L233">            }</span>
        });
<span class="nc" id="L235">    }</span>

    private void limpiarCampos() {
<span class="nc" id="L238">        NombreUsuario.setText(&quot;&quot;);</span>
<span class="nc" id="L239">        NombreCliente.setText(&quot;&quot;);</span>
<span class="nc" id="L240">        Apellido.setText(&quot;&quot;);</span>
<span class="nc" id="L241">        EmailUsuario.setText(&quot;&quot;);</span>
<span class="nc" id="L242">        Documento.setText(&quot;&quot;);</span>
<span class="nc" id="L243">        NacionalidadCliente.setText(&quot;&quot;);</span>
<span class="nc" id="L244">        passwordField.setText(&quot;&quot;);</span>
<span class="nc" id="L245">        ConfirmacionPassword.setText(&quot;&quot;);</span>

        // Limpiar selecci√≥n de radio buttons
<span class="nc" id="L248">        PasaporteRadioButton.setSelected(false);</span>
<span class="nc" id="L249">        CiRadioButton.setSelected(false);</span>

        // Resetear comboboxes de fecha
<span class="nc" id="L252">        DiaNacimiento.setSelectedItem(&quot;D√≠a&quot;);</span>
<span class="nc" id="L253">        MesNacimiento.setSelectedItem(&quot;Mes&quot;);</span>
<span class="nc" id="L254">        AnoNacimiento.setSelectedItem(&quot;A√±o&quot;);</span>

        // Volver al primer campo
<span class="nc" id="L257">        NombreUsuario.requestFocus();</span>
<span class="nc" id="L258">    }</span>

    public Container getPanelDeSesion() {
<span class="nc" id="L261">        return PanelDeSesion;</span>
    }

    // M√©todo para inicializar componentes si usas dise√±ador de GUI
    private void createUIComponents() {
        // Inicializaci√≥n de componentes si es necesario
<span class="nc" id="L267">        passwordField = new JPasswordField();</span>
<span class="nc" id="L268">        ConfirmacionPassword = new JPasswordField();</span>
<span class="nc" id="L269">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>