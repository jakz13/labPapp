<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NuevaRutaVuelo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MiProyectoSwing</a> &gt; <a href="index.source.html" class="el_package">Presentacion.gui.guiSesion</a> &gt; <span class="el_source">NuevaRutaVuelo.java</span></div><h1>NuevaRutaVuelo.java</h1><pre class="source lang-java linenums">package Presentacion.gui.guiSesion;

import logica.Fabrica;
import logica.ISistema;
import DataTypes.DtAerolinea;

import javax.swing.*;
import java.awt.*;
import java.time.LocalDate;

public class NuevaRutaVuelo {
    private String aerolineaSeleccionada;
    private JPanel PanelAltaRuta;
    private JTextField NombreRuta;
    private JTextArea descripcion;
    private JTextField CostoTurista;
    private JTextField CostoEjecutivo;
    private JTextField Equipaje;
    private JButton crear;
    private JButton cancelarButton;
    private JList&lt;String&gt; ListaAereolinea;
    private JComboBox&lt;String&gt; comboBoxCiudadOrigen;
    private JComboBox&lt;String&gt; comboBoxDestino;
    private JComboBox&lt;String&gt; comboBoxCategoria;
    private JTextArea DescripcionCorta; // Campo para descripción corta (JTextArea)
    private JScrollPane scrollPane;
    private JScrollPane scrollPaneDescripcionCorta; // Scroll para la descripción corta

<span class="nc" id="L29">    public NuevaRutaVuelo() {</span>
<span class="nc" id="L30">        ISistema sistema = Fabrica.getInstance().getISistema();</span>

        // --- Aerolíneas ---
<span class="nc" id="L33">        DefaultListModel&lt;String&gt; modeloAerolineas = new DefaultListModel&lt;&gt;();</span>
<span class="nc bnc" id="L34" title="All 2 branches missed.">        for (DtAerolinea a : sistema.listarAerolineas()) {</span>
<span class="nc" id="L35">            String item = a.getNickname() + &quot; (&quot; + a.getNombre() + &quot;)&quot;;</span>
<span class="nc" id="L36">            modeloAerolineas.addElement(item);</span>
<span class="nc" id="L37">        }</span>
<span class="nc" id="L38">        ListaAereolinea.setModel(modeloAerolineas);</span>

<span class="nc" id="L40">        ListaAereolinea.addListSelectionListener(e -&gt; {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">            if (!e.getValueIsAdjusting()) {</span>
<span class="nc" id="L42">                String seleccionado = ListaAereolinea.getSelectedValue();</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">                if (seleccionado != null) {</span>
<span class="nc" id="L44">                    aerolineaSeleccionada = seleccionado.split(&quot; &quot;)[0]; // nickname</span>
                }
            }
<span class="nc" id="L47">        });</span>

        // --- Ciudades ---
<span class="nc" id="L50">        DefaultComboBoxModel&lt;String&gt; modeloOrigen = new DefaultComboBoxModel&lt;&gt;();</span>
<span class="nc" id="L51">        DefaultComboBoxModel&lt;String&gt; modeloDestino = new DefaultComboBoxModel&lt;&gt;();</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">        for (var c : sistema.listarCiudades()) {</span>
<span class="nc" id="L53">            modeloOrigen.addElement(c.getNombre());</span>
<span class="nc" id="L54">            modeloDestino.addElement(c.getNombre());</span>
<span class="nc" id="L55">        }</span>
<span class="nc" id="L56">        comboBoxCiudadOrigen.setModel(modeloOrigen);</span>
<span class="nc" id="L57">        comboBoxDestino.setModel(modeloDestino);</span>

        // --- Categorías ---
<span class="nc" id="L60">        DefaultComboBoxModel&lt;String&gt; modeloCategorias = new DefaultComboBoxModel&lt;&gt;();</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        for (var cat : sistema.listarCategorias()) {</span>
<span class="nc" id="L62">            modeloCategorias.addElement(cat.getNombre());</span>
<span class="nc" id="L63">        }</span>
<span class="nc" id="L64">        comboBoxCategoria.setModel(modeloCategorias);</span>

        // --- Configurar el JTextArea para descripción corta ---
<span class="nc" id="L67">        DescripcionCorta.setLineWrap(true); // Salto de línea automático</span>
<span class="nc" id="L68">        DescripcionCorta.setWrapStyleWord(true); // Salto por palabras completas</span>
<span class="nc" id="L69">        DescripcionCorta.setRows(3); // Altura de 3 líneas</span>

        // --- Crear ruta ---
<span class="nc" id="L72">        crear.addActionListener(e -&gt; {</span>
<span class="nc" id="L73">            String nombreRuta = NombreRuta.getText().trim();</span>
<span class="nc" id="L74">            String Descripcion = descripcion.getText().trim();</span>
<span class="nc" id="L75">            String descripcionCorta = DescripcionCorta.getText().trim(); // Usar el JTextArea</span>
<span class="nc" id="L76">            String origen = (String) comboBoxCiudadOrigen.getSelectedItem();</span>
<span class="nc" id="L77">            String destino = (String) comboBoxDestino.getSelectedItem();</span>
<span class="nc" id="L78">            String categoriaSel = (String) comboBoxCategoria.getSelectedItem();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">            String[] categorias = categoriaSel != null ? new String[]{categoriaSel} : new String[0];</span>

<span class="nc" id="L81">            String hora = &quot;00:00&quot;;</span>
            double costoTurista, costoEjecutivo, equipaje;

            try {
<span class="nc" id="L85">                costoTurista = Double.parseDouble(CostoTurista.getText().trim());</span>
<span class="nc" id="L86">                costoEjecutivo = Double.parseDouble(CostoEjecutivo.getText().trim());</span>
<span class="nc" id="L87">                equipaje = Double.parseDouble(Equipaje.getText().trim());</span>
<span class="nc" id="L88">            } catch (NumberFormatException ex) {</span>
<span class="nc" id="L89">                JOptionPane.showMessageDialog(null,</span>
                        &quot;Costos inválidos. Deben ser números.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L93">                return;</span>
<span class="nc" id="L94">            }</span>

<span class="nc" id="L96">            LocalDate fecha = LocalDate.now();</span>

            // Validaciones más específicas
<span class="nc bnc" id="L99" title="All 2 branches missed.">            if (nombreRuta.isEmpty()) {</span>
<span class="nc" id="L100">                JOptionPane.showMessageDialog(null,</span>
                        &quot;El nombre de la ruta es obligatorio.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L104">                return;</span>
            }

<span class="nc bnc" id="L107" title="All 2 branches missed.">            if (descripcionCorta.isEmpty()) {</span>
<span class="nc" id="L108">                JOptionPane.showMessageDialog(null,</span>
                        &quot;La descripción corta es obligatoria.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L112">                return;</span>
            }

<span class="nc bnc" id="L115" title="All 2 branches missed.">            if (aerolineaSeleccionada == null) {</span>
<span class="nc" id="L116">                JOptionPane.showMessageDialog(null,</span>
                        &quot;Debe seleccionar una aerolínea.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L120">                return;</span>
            }

<span class="nc bnc" id="L123" title="All 4 branches missed.">            if (origen == null || destino == null) {</span>
<span class="nc" id="L124">                JOptionPane.showMessageDialog(null,</span>
                        &quot;Debe seleccionar ciudad de origen y destino.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L128">                return;</span>
            }

<span class="nc bnc" id="L131" title="All 2 branches missed.">            if (origen.equals(destino)) {</span>
<span class="nc" id="L132">                JOptionPane.showMessageDialog(null,</span>
                        &quot;La ciudad de origen y destino no pueden ser iguales.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L136">                return;</span>
            }

<span class="nc bnc" id="L139" title="All 2 branches missed.">            if (categorias.length == 0) {</span>
<span class="nc" id="L140">                JOptionPane.showMessageDialog(null,</span>
                        &quot;Debe seleccionar al menos una categoría.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L144">                return;</span>
            }

            // Validar longitud de descripción corta (opcional)
<span class="nc bnc" id="L148" title="All 2 branches missed.">            if (descripcionCorta.length() &gt; 255) {</span>
<span class="nc" id="L149">                JOptionPane.showMessageDialog(null,</span>
                        &quot;La descripción corta no puede exceder los 255 caracteres.&quot;,
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L153">                return;</span>
            }

            try {
                // Llamar al método actualizado con descripción corta
<span class="nc" id="L158">                sistema.altaRutaVuelo(nombreRuta, Descripcion, descripcionCorta,</span>
<span class="nc" id="L159">                        sistema.obtenerAerolinea(aerolineaSeleccionada),</span>
                        origen, destino, hora, fecha,
                        costoTurista, costoEjecutivo, equipaje, categorias,null);

<span class="nc" id="L163">                JOptionPane.showMessageDialog(null,</span>
                        &quot;Ruta creada correctamente.\nEstado: INGRESADA - Esperando aprobación del administrador.\n\n&quot; +
                                &quot;Nombre: &quot; + nombreRuta + &quot;\n&quot; +
                                &quot;Descripción corta: &quot; + descripcionCorta + &quot;\n&quot; +
                                &quot;Aerolínea: &quot; + aerolineaSeleccionada + &quot;\n&quot; +
                                &quot;Ruta: &quot; + origen + &quot; → &quot; + destino,
                        &quot;Ruta Creada - Pendiente de Aprobación&quot;,
                        JOptionPane.INFORMATION_MESSAGE);

                // Limpiar campos después de crear
<span class="nc" id="L173">                limpiarCampos();</span>

<span class="nc" id="L175">            } catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L176">                JOptionPane.showMessageDialog(null,</span>
<span class="nc" id="L177">                        &quot;Error al crear la ruta:\n&quot; + ex.getMessage(),</span>
                        &quot;Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L180">            }</span>
<span class="nc" id="L181">        });</span>

        // --- Cancelar ---
<span class="nc" id="L184">        cancelarButton.addActionListener(e -&gt; {</span>
<span class="nc" id="L185">            JFrame topFrame = (JFrame) SwingUtilities.getWindowAncestor(PanelAltaRuta);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (topFrame != null) topFrame.dispose();</span>
<span class="nc" id="L187">        });</span>
<span class="nc" id="L188">    }</span>

    private void limpiarCampos() {
<span class="nc" id="L191">        NombreRuta.setText(&quot;&quot;);</span>
<span class="nc" id="L192">        descripcion.setText(&quot;&quot;);</span>
<span class="nc" id="L193">        DescripcionCorta.setText(&quot;&quot;); // Limpiar el JTextArea</span>
<span class="nc" id="L194">        CostoTurista.setText(&quot;&quot;);</span>
<span class="nc" id="L195">        CostoEjecutivo.setText(&quot;&quot;);</span>
<span class="nc" id="L196">        Equipaje.setText(&quot;&quot;);</span>
<span class="nc" id="L197">        ListaAereolinea.clearSelection();</span>
<span class="nc" id="L198">        comboBoxCiudadOrigen.setSelectedIndex(0);</span>
<span class="nc" id="L199">        comboBoxDestino.setSelectedIndex(0);</span>
<span class="nc" id="L200">        comboBoxCategoria.setSelectedIndex(0);</span>
<span class="nc" id="L201">        aerolineaSeleccionada = null;</span>
<span class="nc" id="L202">    }</span>

    public Container getPanelAltaRuta() {
<span class="nc" id="L205">        return PanelAltaRuta;</span>
    }

    // Método para crear los componentes de la GUI (necesario para el diseñador de GUI)
    private void createUIComponents() {
        // Inicialización de componentes si es necesario
<span class="nc" id="L211">        DescripcionCorta = new JTextArea();</span>
<span class="nc" id="L212">        DescripcionCorta.setLineWrap(true);</span>
<span class="nc" id="L213">        DescripcionCorta.setWrapStyleWord(true);</span>
<span class="nc" id="L214">        DescripcionCorta.setRows(3);</span>

        // Crear scroll pane para la descripción corta
<span class="nc" id="L217">        scrollPaneDescripcionCorta = new JScrollPane(DescripcionCorta);</span>
<span class="nc" id="L218">        scrollPaneDescripcionCorta.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);</span>
<span class="nc" id="L219">        scrollPaneDescripcionCorta.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);</span>
<span class="nc" id="L220">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>